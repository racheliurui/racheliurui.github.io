<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="AWS Best practise,AWS EMR (Elastic MapReduce),">





  <link rel="alternate" href="/atom.xml" title="Hey Hey Hey" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="Introduction Moving data to AWS --&amp;gt; Data Collection --&amp;gt; Data Aggregation --&amp;gt; Data Processing --&amp;gt; Cost and Performance Optimizations  1. Moving data to AWS Means moving bulk of the existin">
<meta name="keywords" content="AWS Best practise,AWS EMR (Elastic MapReduce)">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS - AWS EMR best practise">
<meta property="og:url" content="https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/index.html">
<meta property="og:site_name" content="Hey Hey Hey">
<meta property="og:description" content="Introduction Moving data to AWS --&amp;gt; Data Collection --&amp;gt; Data Aggregation --&amp;gt; Data Processing --&amp;gt; Cost and Performance Optimizations  1. Moving data to AWS Means moving bulk of the existin">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2021-06-15T03:43:00.421Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AWS - AWS EMR best practise">
<meta name="twitter:description" content="Introduction Moving data to AWS --&amp;gt; Data Collection --&amp;gt; Data Aggregation --&amp;gt; Data Processing --&amp;gt; Cost and Performance Optimizations  1. Moving data to AWS Means moving bulk of the existin">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/">





  <title>AWS - AWS EMR best practise | Hey Hey Hey</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hey Hey Hey</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rachel Rui Liu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://raw.githubusercontent.com/racheliurui/markdown/master/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey Hey Hey">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">AWS - AWS EMR best practise</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-06T19:15:23+00:00">
                2018-05-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1>
<p>Moving data to AWS --&gt; Data Collection --&gt; Data Aggregation --&gt; Data Processing --&gt; Cost and Performance Optimizations</p>
<h2 id="1-moving-data-to-aws"><a class="markdownIt-Anchor" href="#1-moving-data-to-aws"></a> 1. Moving data to AWS</h2>
<p>Means moving bulk of the existing data to AWS</p>
<ul>
<li>Moving Direction
<ul>
<li>Local Storage &lt;â€“&gt; AWS S3
<ul>
<li>Local HDFS --&gt; S3
<ul>
<li>using S3DistCp: an extension of DistCp with optimizatios to AWS</li>
<li>using DistCp</li>
</ul>
</li>
<li>Local Filesystem --&gt; AWS S3
<ul>
<li>opensourced tools support multi-threading: Jets3t / GNU Parallel</li>
<li>Aspera Direct-to-S3: a file transfer protocol based on UDP and with optimizations to AWS</li>
<li>Device based import/export</li>
<li>AWS Direct Connect
<ul>
<li>One-time direct connection: once bulk data trasferred, stop the direct connection</li>
<li>On going direct connection: always connected</li>
</ul>
</li>
</ul>
</li>
<li>S3 --&gt; Local HDFS
<ul>
<li>using S3DistCP or DistCP</li>
</ul>
</li>
</ul>
</li>
<li>AWS S3 --&gt; AWS EMR</li>
<li>AWS S3 --&gt; HDFS</li>
</ul>
</li>
<li>With good optimization: several Terabytes a day</li>
</ul>
<h2 id="2-data-collection"><a class="markdownIt-Anchor" href="#2-data-collection"></a> 2. Data Collection</h2>
<p>Means streaming data to AWS</p>
<ul>
<li>Apache Flume : collected data can be sent to S3, HDFS and more</li>
<li>Fluentd: collected data can be sent to S3, SQS , MongoDB, Redis and more</li>
</ul>
<h2 id="3-data-aggregation"><a class="markdownIt-Anchor" href="#3-data-aggregation"></a> 3. Data Aggregation</h2>
<p>Means, aggregated collected data at proper size before sending to target storage (S3, HDFS, EMR).</p>
<ul>
<li>
<p>Benefit of Aggregation</p>
<ul>
<li>aggregated files means less uploading times</li>
<li>aggregated files give better performance to Hadoop</li>
<li>aggregated files have better compression ratio</li>
</ul>
</li>
<li>
<p>How to Aggreate</p>
<ul>
<li>Apache Flume and Fluentd have parameters to support</li>
<li>S3DistCp has aggregation feature</li>
</ul>
</li>
<li>
<p>How to decide best aggregation size</p>
<ul>
<li>Background knowledge: how file is splitted
<ul>
<li>If file is saved on HDFS, Hadoop will split the file into multiple data blocks and assign map task to each block</li>
<li>If file is saved in S3, EMR will use multiple get to get multiple data blocks of same file from S3 storage (default is about 64MB a block); but file size bigger than 4GB in GZIP format will result in logjams for EMR.</li>
<li>If the file is zipped , and with a format not supporting split (GZIP not supporting file splitting), then only 1 mapper task will be assigned</li>
</ul>
</li>
<li>Best practise 1: select correct aggregated file size
<ul>
<li>GZIP 1-2GB</li>
<li>LZO (other format that support split): 2-4GB</li>
</ul>
</li>
<li>Best Practise 2: control the file size at best size
<ul>
<li>itâ€™s hard because most of the data collector only support time based file spliting. You might need to adjust the time to make sure the generated file fits in best size.</li>
</ul>
</li>
<li>Best Practise 3: select data compression algorithms
<ul>
<li>If you choose GZIP format, then file should be around 1G, otherwise change to algorithms that support splitting</li>
<li>Why compression is good: less storage/IO/bandwidth</li>
<li>places that we can apply compression in MapReduce
<ul>
<li>input file</li>
<li>mapper or reducerâ€™s intermediate output: reduce the copy and reduce the data spill</li>
</ul>
</li>
<li>Summary, 4 considerations when choosing algorithm
<ul>
<li>speed requirement for compress / decompress</li>
<li>data storage size</li>
<li>original aggregated file size (need split or not), if itâ€™s too big , then have to select an algorithm that support splitting</li>
<li>native lib like gzip usually runs faster</li>
</ul>
</li>
</ul>
</li>
<li>Best Practise 4: Data Partitioning
<ul>
<li>here means the organization of the data file should match with the way how you want to process it. For example, data analysised by date better been stored by date (different date, different directory)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-data-processing-with-aws-emr"><a class="markdownIt-Anchor" href="#4-data-processing-with-aws-emr"></a> 4. Data processing with AWS EMR</h2>
<p>EMR will use HDFS or S3 to do mapreduce.</p>
<h3 id="picking-correct-instance"><a class="markdownIt-Anchor" href="#picking-correct-instance"></a> picking correct instance</h3>
<ul>
<li>Memory intensive job choose m prefix EC2 family</li>
<li>CPU intensive job choose C prefix EC2 family</li>
</ul>
<h3 id="picking-right-number-of-instances"><a class="markdownIt-Anchor" href="#picking-right-number-of-instances"></a> picking right number of Instances</h3>
<ul>
<li>If you want it faster, then make sure each split has a mapper task running in parallel, and depending on EC2 instance type, for example m1.small can run 2 mappers in parallel (m1.large can run 30 mappers), you can calculate the number of instances needed.</li>
<li>If you donâ€™t care the speed, then just choose less number of instance, the tasks will be queued</li>
<li>EMR will charge by full hour.</li>
</ul>
<h3 id="estimating-number-of-mappers"><a class="markdownIt-Anchor" href="#estimating-number-of-mappers"></a> estimating number of mappers</h3>
<ul>
<li>Given the block size of S3 or HDFS, we know how a given file is splitted. Then we can calculate the mapper number needed.</li>
<li>Or the JobTracker GUI or output will tell</li>
</ul>
<h3 id="picking-emr-type"><a class="markdownIt-Anchor" href="#picking-emr-type"></a> picking EMR type</h3>
<ul>
<li>Transient EMR Cluster
<ul>
<li>Suitable for data in S3; Processig is not all day long continious ; job is intensive ,iterative data processing</li>
<li>For machine learning, data load once , calculated multiple times.</li>
</ul>
</li>
<li>Persistent EMR Cluster</li>
</ul>
<h3 id="common-emr-patterns"><a class="markdownIt-Anchor" href="#common-emr-patterns"></a> Common EMR patterns</h3>
<ul>
<li>Data sits in S3 and EMR do not have local HDFS, it directly pull data from S3 and do map reduce</li>
<li>Data sits in S3 and EMR will copy to local HDFS and then do map reduce â€”&gt; Suitable for Machine Learning, copy once, calculate many times</li>
<li>Data sits in HDFS and backup &amp; result to S3 --&gt; suitable when data loss is acceptable</li>
<li>Manual Adjust the cluster by monitor: number of mappers running; number of mappers outstanding; number of reducers running; number of reducers outstanding;</li>
<li>Dynamic adjust the Cluster
<ul>
<li>Master Node (JobTracker and NameNode); Core node(TaskTracker and DataNode); Task node (TaskTracker)</li>
<li>task node which do no contains HDFS storage can be add and removed dynamically</li>
<li>CloudWatch metrices can be used to decide how to adjust the cluster dynamically</li>
</ul>
</li>
</ul>
<h2 id="5-optimizing-cost"><a class="markdownIt-Anchor" href="#5-optimizing-cost"></a> 5. Optimizing Cost</h2>
<ul>
<li>&lt;17% planned use on-demand</li>
<li>
<blockquote>
<p>17% planned use reserved</p>
</blockquote>
<ul>
<li>light reserved for planned a few hoursâ€™ job</li>
<li>medium reserved</li>
<li>heavy reserved for all day round job</li>
</ul>
</li>
<li>unplanned short period and can wait : on spot instance
<ul>
<li>the more the bit close to on-demand price, the more chance to get it done</li>
<li>If data is not in S3, then master node shouldnâ€™t put on spot instance; core node better not put on spot instance ( at least put more in on-demand or reserved nodes).</li>
</ul>
</li>
</ul>
<h1 id="6-performance-optimization"><a class="markdownIt-Anchor" href="#6-performance-optimization"></a> 6. Performance Optimization</h1>
<ul>
<li>Data structure is key for Performance</li>
<li>Hadoop is batch-processing measured by hours to days, if you need improve time by a few minutes to meet SLA, then look at Storm or Spark</li>
<li>EMR charges on hourly increments.</li>
<li>make use of task node</li>
</ul>
<h2 id="benchmark-testing"><a class="markdownIt-Anchor" href="#benchmark-testing"></a> benchmark testing</h2>
<ul>
<li>eliminate variables while testing. For example, load data to HDFS if you are testing CPU and Memory, otherwise dataloading time from S3 might be the bottleneck.</li>
<li>Make use of Ganalia to monitor your EMR.</li>
</ul>
<p>Refer the original document for other Performance Test tips</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Reward Makes Perfect</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    

    

    
      <div id="bitcoin" style="display: inline-block">
        <img id="bitcoin_qr" src="/images/bitcoin.png" alt="Rachel Rui Liu Bitcoin">
        <p>Bitcoin</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    Rachel Rui Liu
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/" title="AWS - AWS EMR best practise">https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/AWS-Best-practise/" rel="tag"># AWS Best practise</a>
          
            <a href="/tags/AWS-EMR-Elastic-MapReduce/" rel="tag"># AWS EMR (Elastic MapReduce)</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/04/markdown/AWS/AWS2018/aws_summerize/" rel="next" title="AWS - Summarzie">
                <i class="fa fa-chevron-left"></i> AWS - Summarzie
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/13/markdown/AWS/AWS2018/BestPractices_AWS_Security/" rel="prev" title="AWS - Security best practise">
                AWS - Security best practise <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="https://raw.githubusercontent.com/racheliurui/markdown/master/images/avatar.jpg" alt="Rachel Rui Liu">
          <p class="site-author-name" itemprop="name">Rachel Rui Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">178</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">193</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/racheliurui" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/rachel-rui-liu-a474a7a" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                    
                      Linkedin
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduction"><span class="nav-number">1.</span> <span class="nav-text"> Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-moving-data-to-aws"><span class="nav-number">1.1.</span> <span class="nav-text"> 1. Moving data to AWS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-data-collection"><span class="nav-number">1.2.</span> <span class="nav-text"> 2. Data Collection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-data-aggregation"><span class="nav-number">1.3.</span> <span class="nav-text"> 3. Data Aggregation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-data-processing-with-aws-emr"><span class="nav-number">1.4.</span> <span class="nav-text"> 4. Data processing with AWS EMR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#picking-correct-instance"><span class="nav-number">1.4.1.</span> <span class="nav-text"> picking correct instance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#picking-right-number-of-instances"><span class="nav-number">1.4.2.</span> <span class="nav-text"> picking right number of Instances</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#estimating-number-of-mappers"><span class="nav-number">1.4.3.</span> <span class="nav-text"> estimating number of mappers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#picking-emr-type"><span class="nav-number">1.4.4.</span> <span class="nav-text"> picking EMR type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#common-emr-patterns"><span class="nav-number">1.4.5.</span> <span class="nav-text"> Common EMR patterns</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-optimizing-cost"><span class="nav-number">1.5.</span> <span class="nav-text"> 5. Optimizing Cost</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-performance-optimization"><span class="nav-number">2.</span> <span class="nav-text"> 6. Performance Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#benchmark-testing"><span class="nav-number">2.1.</span> <span class="nav-text"> benchmark testing</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rachel Rui Liu</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://racheliurui-github-io.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://racheliurui.github.io/2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/';
          this.page.identifier = '2018/05/06/markdown/AWS/AWS2018/BestPractices_AWS_EMR/';
          this.page.title = 'AWS - AWS EMR best practise';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://racheliurui-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  


  

  

</body>
</html>
